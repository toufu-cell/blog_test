# 📁 スクリプトディレクトリ

このディレクトリには、ブログCMSの管理・メンテナンス用スクリプトが含まれています。

## 🔄 データベースリセットスクリプト

### 概要
`reset_database` コマンドは、開発・テスト環境でデータベースを安全にリセットするためのツールです。
**adminユーザーは自動的に保持**され、他のデータのみが削除されます。

### 使用方法

#### 1. Djangoコマンドとして実行

```bash
# 基本リセット（確認プロンプト付き）
python manage.py reset_database

# サンプルデータ付きリセット
python manage.py reset_database --create-sample

# 確認なしで実行
python manage.py reset_database --confirm

# 特定のadminユーザーを指定
python manage.py reset_database --admin-username myAdmin
```

#### 2. シェルスクリプトで実行

```bash
# スクリプトを実行（対話式メニュー）
./scripts/reset_db.sh
```

### オプション詳細

| オプション | 説明 |
|-----------|------|
| `--confirm` | 確認プロンプトをスキップ |
| `--create-sample` | リセット後にサンプルデータを作成 |
| `--admin-username` | 保持するadminユーザー名（デフォルト: admin） |

### リセット対象データ

#### 削除されるデータ
- ✅ adminユーザー以外の全ユーザー
- ✅ ユーザープロファイル（admin以外）
- ✅ 全記事とその関連データ
- ✅ 全コメントとその関連データ
- ✅ 全タグ
- ✅ 記事閲覧履歴
- ✅ いいね・評価データ
- ✅ 報告・管理ログ

#### 保持されるデータ
- 🔒 adminユーザー（username: admin）
- 🔒 adminユーザーのプロファイル

### サンプルデータ内容

`--create-sample` オプションを使用すると、以下のデータが作成されます：

#### 作成されるユーザー
- **username**: `sample_editor`
- **email**: `editor@example.com`
- **password**: `password123`
- **role**: `editor`

#### 作成されるタグ
- Python (青色)
- Django (緑色)
- JavaScript (黄色)
- React (水色)

#### 作成される記事
1. **Djangoブログシステムの構築**
   - タグ: Python, Django
   - 状態: 公開済み、注目記事

2. **React + Next.jsでモダンなフロントエンド開発**
   - タグ: JavaScript, React
   - 状態: 公開済み

#### 作成されるコメント
- 各記事に1件ずつサンプルコメント

### 安全性機能

1. **adminユーザー保護**
   - 指定されたadminユーザーは絶対に削除されません
   - adminユーザーが見つからない場合、操作は中断されます

2. **確認プロンプト**
   - `--confirm` オプションなしでは必ず確認が表示されます
   - 誤操作を防ぐための安全装置

3. **トランザクション処理**
   - 全ての操作が単一トランザクション内で実行
   - エラー発生時は自動的にロールバック

4. **詳細ログ**
   - 実行前後のデータ状況を表示
   - 各ステップの進行状況を出力

### 実行例

```bash
$ python manage.py reset_database --create-sample

🚨 データベースリセット操作 🚨
✅ 保持対象adminユーザー: admin (admin@example.com)

📊 現在のデータ状況:
  👥 ユーザー: 3人
  📝 記事: 3件
  🏷️  タグ: 1個
  💬 コメント: 2件
  👀 記事閲覧: 30件
  👍 記事いいね: 1件
  💭 コメントいいね: 2件

本当にデータベースをリセットしますか？ (yes/no): yes

🔄 データベースリセットを開始...
  🗑️  コメント関連データを削除中...
  🗑️  記事関連データを削除中...
  🗑️  タグを削除中...
  🗑️  ユーザー（admin除く）を削除中...
  ✅ adminユーザー "admin" を保持してリセット完了

🎯 サンプルデータを作成中...
✅ サンプルデータを作成しました:
  - サンプルユーザー: sample_editor
  - タグ: 4個
  - 記事: 2件
  - コメント: 2件

✅ データベースリセットが完了しました

📊 現在のデータ状況:
  👥 ユーザー: 2人
  📝 記事: 2件
  🏷️  タグ: 4個
  💬 コメント: 2件
  👀 記事閲覧: 0件
  👍 記事いいね: 0件
  💭 コメントいいね: 0件
```

### 注意事項

⚠️ **本番環境では絶対に使用しないでください**
⚠️ **実行前に必ずデータベースのバックアップを取ってください**
⚠️ **adminユーザーのパスワードや設定は変更されません**

### トラブルシューティング

#### よくある問題

1. **adminユーザーが見つからない**
   ```
   ❌ adminユーザー "admin" が見つかりません
   ```
   - 解決方法: `--admin-username` オプションで正しいadminユーザー名を指定

2. **権限エラー**
   - 解決方法: 仮想環境がアクティブになっているか確認

3. **データベース接続エラー**
   - 解決方法: データベースサーバーが起動しているか確認 